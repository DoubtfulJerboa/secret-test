name: loop secret

on:
  push:
    branches:
      - main

jobs: 
    job1:
        runs-on: ubuntu-latest
        outputs:
          matrix: ${{ steps.set-matrix.outputs.matrix }}
        steps:
          - id: set-matrix
            run: echo 'matrix=${{secrets.CLIENTSJSON}}' >> $GITHUB_OUTPUT
    
    matrixotest:
        needs: job1
        runs-on: ubuntu-latest
        strategy:
            matrix: 
                client: ${{ fromJSON(needs.job1.outputs.matrix) }}
        steps:
            - run: echo "${{ matrix }}"
    
    do:
        runs-on: ubuntu-latest
        steps:
            - run: echo "foooobar"
            - run: echo '${{ secrets.CLIENTS }}'
            # - uses: actions/setup-python@v4
            #   with:
            #     python-version: '3.x'
            # - name: python shiz
            #   uses: jannekem/run-python-script-action@v1
            #   with:
            #     script: |
            #       import json
            #       print("theoretically loop through each one for deployment, but need to make these referencable from deployment? or somehow remake deployment all in python")
            #       for item in json.loads("""${{secrets.CLIENTS}}"""):
            #         print(item)

            # this only works for single line entries "one" "two" "three"
            - run: |
                declare -a clients=(${{secrets.CLIENTS}})
                for i in "${clients[@]}"
                do
                    echo "$i"
                done